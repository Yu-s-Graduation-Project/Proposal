# 开题报告

## 研究背景和意义

浮点运算在计算机系统中十分普遍，编译器也常常要求处理浮点数据类型、编译与浮点相关的算法。而在现实生活中，浮点运算在各类应用中十分常见，但同时浮点运算也带来了一些问题。浮点数位数有限，保存在内存中的数字通常四舍五入到最接近的可能值，在很多情况下，实际值和浮点近似值之间微小的误差可能会导致非常严重的后果。在高精度的应用中，普通的浮点运算无法满足要求，在某些情况下细小的浮点误差累积会引起问题甚至悲剧，著名的浮点误差导致的错误事件如爱国者导弹未能拦截、奔腾浮点除法错误。

传统的浮点误差分析研究提供了一些动态分析程序并找出大浮点误差错误的算法和工具，能够帮助相关应用行业的软件工程师发现和解决一些浮点误差错误。但这些工具有局限性，大多依赖于动态执行程序，成本相对较高；解决方法相对单一，不能很好满足业界的一些特定浮点相关算法需求或者特定复杂运算。这篇文章提供了进行数值分析的方法和工具，它以LLVM编译器为基础，生成应用程序的改进IR中间码和最终可用的二进制码，将二进制码作为数据集，应用机器学习训练数据并进行应用。它具有一些有实际应用的优点：（1） 它不依赖于复杂的高精度算法和逻辑应用，因而并不需要一些特定和难以获取的复杂计算工具，能够提供一定算力即可，初始即可快速高效地识别常见的库函数大浮点误差；（2）工具具有普适应，高效准确，能够通过训练相关需求应用的特定数据集，而数据集的获取仅需要提供程序源码，工具自动生成对应的模块化IR中间码以及最终的二进制码进行训练。因而能够较为快速准确地识别出存在浮点数误差的源代码并给予测试人员和软件工程师相应的提示。

我承担了改进程序源代码生成的IR中间码以及最终可用的二进制码工作，具体工作包括修改LLVM部分库（如生成IR中间码的工具lli）和部分库（如将中间码转化为二进制码的AsmWriter），并处理疏通了相应部分的逻辑（如if分支，循环等），对不同的目标库函数进行了系列测试和比较，demo使用的例子为平方根差值函数（sqrt(x + 1) - sqrt(x)），并将相应结果作为数据进行了一些机器学习的初步训练，进行效果调整和改善。



## 文献综述

浮点计算在科学，过程，经济等应用中广为使用，浮点数也常常被用来近似表示真实数值。浮点数位数的有限表示会导致浮点计算的不精确，进而导致应用领域的灾难。对于从事相关工作的软件工程师来说，写一段健壮安全的浮点计算程序并不容易，甚至一个熟悉浮点精确度问题的软件工程师也可能不能检测出问题代码并加以防范。当代计算系统不断提升的性能和复杂度让识别浮点错误变得更加重要和困难，因此，对于浮点误差分析引起了国内外研究者们的重视。

事实上，在过去已经发布了一些静态分析和动态分析浮点数程序并检测误差的工具。静态程序分析工具如 FLUCTUAT，能够检测输入的一段程序，在考虑真实值和精确度的情况下给出程序中所有变量的边界值，输出所有可能执行的输入输出结果。同时它能够限定误差结果并在程序源代码中体现。但同时FLUCTUAT的缺点也很明显，基于静态程序分析给出的结果往往并不精确（大量存疑的结果）；很依赖于如指针分析的其他分析来消除数据流的歧义性。这些问题在其他应用静态程序分析解决浮点误差的工具中也很常见，因而这类工具在不含复杂和动态变化的数据结构的应用程序和系统中较为实用，如嵌入式系统。但是对于使用常规OO语言实现的。系统效果并不理想。因此，传统的静态分析浮点误差的工具并不能很好覆盖现实例子和满足应用领域的要求。

相对地，动态分析浮点误差的工具能在很大程度上保证结果的精确性和确定性。动态二进制分析工具 Herbrind 能够分析导致浮点误差的源；根据原子条件动态分析程序检测浮点误差的工具能够更高效分析程序并保证一定的精确性。但两者均存在一定缺陷：Herbind 为了解决浮点错误难以构建和识别的问题，将工具基于控制流输出结果和操作符的追踪。同时为了解决错误的难以追踪和不规范化，Herbrind 提供符号化的表达式来抽象程序模块和流程，将输出结果在分析过程中加以区分。这些解决方案有利于保证 Herbrind 结果的精确性，但并不适用于解决大规模的复杂系统。与之相对，根据原子条件动态分析程序检测浮点误差的工具显得更为高效和简单，它不依赖于复杂的分析和实现，专注于原子操作符和条件来检测大浮点误差。这是更为关注导致浮点误差本质的研究思路和方法，但不可避免地在应对复杂系统和逻辑中，检测大浮点错误和定位源代码的位置并不容易，对于相关应用的特定情况和需求并不能很好地覆盖和满足。

因而在现有研究的基础上，我们希望能够尽量不依赖于复杂的程序分析实现和外部工具，高效分析大规模应用并尽可能满足特定需求，保证精确性。

## 文献



-  Zou D M,  Zeng M H, Xiong Y F, Fu ZL, et al. 2020. Detecting Floating- Point Errors via Atomic Conditions. Proc. ACM Program. Lang. 4, POPL, Article 60 (January 2020), 27 pages.   https://people.inf.ethz.ch/suz/publications/popl20.pdf

-  Sanchez-Stern A, Panchekha P, Lerner S, et al. 2018. Finding Root Causes of Floating Point Error. In Pro- ceedings of 39th ACM SIGPLAN Conference on Programming Lan- guage Design and Implementation (PLDI’18). ACM, New York, NY, USA, 14 pages. https://doi.org/10.1145/3192366.3192411 
-  Benz F, Andreas H, Sebastian H. A Dynamic Program Analysis to find Floating-Point Accuracy Problems. PLDI '12: Proceedings of the 2012 ACM SIGPLAN Conference on Programming Language Design and Implementation. http://compilers.cs.uni-saarland.de/papers/benz_fp.pdf

